<div id="page">

# The Malware of Ultimate Destruction

[Eric Lippert](https://social.msdn.microsoft.com/profile/Eric%20Lippert) 10/18/2003 3:42:00 PM

-----

<div id="content">

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">The other day Peter was talking about the [ActiveX Control of Ultimate Destruction](http://blogs.gotdotnet.com/ptorr/PermaLink.aspx/5eded8da-11f4-4b9c-adbb-e175c52bfd10) -- a hostile control which, the moment it is loaded immediately formats your hard disk.<span style="mso-spacerun: yes">  </span>The aim of the ACoUD is to do "as much damage as possible in a short amount of time".</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">Well, Peter's not the only one who's kept up at night worrying about this stuff.<span style="mso-spacerun: yes">  </span>Last night I couldn't sleep because I was thinking about how that characterization of the ACoUD really isn't bad enough.<span style="mso-spacerun: yes">  </span>If this is going to be the ULTIMATE in destruction, let's think about just how evil we can get.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">For the purposes of this discussion, let's not care about how the evil code gets on your machine.<span style="mso-spacerun: yes">  </span>Perhaps you download and trust a malicious ActiveX control.<span style="mso-spacerun: yes">  </span>Perhaps a worm takes advantage of a buffer overrun in the operating system.<span style="mso-spacerun: yes">  </span>Perhaps you got an email virus, or ran a bad macro, or whatever.<span style="mso-spacerun: yes">  </span>Let's just call all those things **malware**.<span style="mso-spacerun: yes">  </span>Furthermore, let's assume that all attempts to stop the malware from running -- like never logging in as administrator, etc, -- have failed and that **the malware has elevated its privilege to administrator**. <span style="mso-spacerun: yes"> </span>Let's assume that the malware author is **brilliant** and has **unlimited time** to craft something **incredibly devious**.<span style="mso-spacerun: yes">  </span>Remember, we're going for the *ultimate* here.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">Here's the worst I could come up with: </span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">\* when the malware is run, first it waits until some point when no one is using the machine.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">\* When the coast is clear, it compresses and backs up the entire hard disk.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">\* It then installs a minimal linux kernel on the box along with a cleverly written Windows emulator.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">\* The state of the emulator is set up to exactly mimic the state of the machine as it was before the attack.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">\* The linux boot sequence is rewritten to exactly resemble the Windows boot sequence, except that of course what is really happening is that linux is loading a windows emulator during the boot.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">The net result: **you are not even running Windows anymore so *nothing* is trustworthy**.<span style="mso-spacerun: yes">  </span>The emulator could be logging every keystroke, sending your files to Brazil , whatever the emulator writer wants.<span style="mso-spacerun: yes">  </span>The emulator could be reporting that no, there is no linux boot partition on this disk\!<span style="mso-spacerun: yes">  </span>You don't own that box anymore.<span style="mso-spacerun: yes">  </span>The chain of trust has been broken. </span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">How could you detect this attack?<span style="mso-spacerun: yes">  </span>Since you're not running Windows, you can't assume that the operating system will report *anything* about the machine correctly.<span style="mso-spacerun: yes">  </span>You'd have to boot off of trustworthy media and run utility programs to examine the real state of the disk.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">How could you prevent this ultimate attack?<span style="mso-spacerun: yes">  </span>Remember, we're assuming that all the usual good stuff has failed, like keeping up-to-date with patches, not running as administrator, maintaining firewalls, not opening suspicious email attachments, and so on.<span style="mso-spacerun: yes">  </span>What is the final line of defense against this sort of ultimate malware?<span style="mso-spacerun: yes">  </span>Really the only line of defense that remains is the hardware.<span style="mso-spacerun: yes">  </span>To solve this problem the chain of trust needs to be rooted in the hardware, so that when the machine boots it can tell you whether you are loading code that has been signed by a trusted authority or not. <span style="mso-spacerun: yes"> </span>The possibility of constructing such chips has met with considerable controversy over the last few years, and it remains to be seen whether they are technically and economically feasible.<span style="mso-spacerun: yes">  </span> </span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">Regardless, the point is that though this is in many ways a ridiculous "overkill" attack, it is in principle possible. This is why trustworthy computing is so incredibly important.<span style="mso-spacerun: yes">  </span>At the very least, you need to have confidence that when you boot up your machine, you are actually running the operating system that you installed\!</span>

<div style="BORDER-RIGHT: medium none; PADDING-RIGHT: 0in; BORDER-TOP: medium none; PADDING-LEFT: 0in; PADDING-BOTTOM: 1pt; BORDER-LEFT: medium none; PADDING-TOP: 0in; BORDER-BOTTOM: windowtext 3pt dotted; mso-element: para-border-div">

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

</div>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">I was thinking about all of this last night because of the recent successful attack against Valve, a local software company that made the popular video game "Half Life".<span style="mso-spacerun: yes">  </span>I don't know the exact details -- and probably no one does except for the attackers who perpetrated the attack -- but what seems likely is that attackers exploited a known vulnerability in Outlook, and a high-ranking Valve employee was vulnerable to the attack.<span style="mso-spacerun: yes">  </span>The malware installed a key press logger, and from that point, it was pretty much game over, so to speak.<span style="mso-spacerun: yes">  </span>By monitoring key presses they'd quickly learn all kinds of details such as the administrator passwords to other machines, compromise them, and eventually manage to "own" as much of the network as possible.<span style="mso-spacerun: yes">  </span>The attackers didn't have to emulate all of Windows, they just had to tweak it a tiny bit by installing a key logger.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">The fact that this underscores the importance of keeping up to date on patches is not particularly relevant, and I do not ever want to blame the victim for failing to patch a machine.<span style="mso-spacerun: yes">  </span>The important point which this illustrates is that there is a spectrum of malware out there.<span style="mso-spacerun: yes">  </span>Consider the Blaster worm, which simply tries to cause as much havoc as possible and spread as fast as possible -- that thing wasn't targeted against anyone in particular, and though it was very costly, it was akin to a hurricane that blows through and wrecks a lot of stuff.<span style="mso-spacerun: yes">  </span>But it certainly announces itself.<span style="mso-spacerun: yes">  </span>I mean, it might as well put up a big dialog box that says YOU ARE OWNZORD BY BLASTER -- Blaster was about as subtle as a brick through a window.</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">The Valve attackers were far cleverer and subtler. Their attack was focused on a particular individual at a particular company and depended on slowly and carefully gathering the information needed to launch further attacks, avoiding detection until the job was finished.<span style="mso-spacerun: yes">  </span>You can rapidly write and disseminate a virus checker for "broad distribution" worms, viruses and Trojans, but it is very hard to write a "virus checker" for custom built malware that only attacks a single person\!</span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">This second kind of attack I suspect is far, far more common than the first and ultimately costlier.<span style="mso-spacerun: yes">  </span>But since the first kind is by its nature highly visible, and the second is by its nature as invisible as possible, the former gets a lot more press.<span style="mso-spacerun: yes">  </span> </span>

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;"> </span>

 

<span style="FONT-SIZE: 10pt; COLOR: purple; FONT-FAMILY: &#39;Lucida Sans Unicode&#39;; mso-bidi-font-family: &#39;Times New Roman&#39;">We need to solve this problem and produce a more trustworthy digital infrastructure.<span style="mso-spacerun: yes">  </span>It will not happen overnight, but I am very confident that we are on the right track.</span>

</div>

</div>

