# Making Sense of HRESULTS

[Eric Lippert](https://social.msdn.microsoft.com/profile/Eric%20Lippert) 10/22/2003 1:40:00 PM

-----

 

 

 

 

Every now and then -- like, say, this morning -- someone sends me this mail:   

 

 

I'm getting an error in my JScript program.  The error number is -2147024877.  No description.  Help\!

 

 

Making sense of those error numbers requires some delving into the depths of how COM represents errors -- the HRESULT.

 

 

An HRESULT is a 32 bit unsigned integer where the high bit indicates whether it is an error or a success.  The remaining bits in the high word indicate the "facility" of the error -- into what broad category does this error fall?  The low word indicates the specific error for that facility.

 

 

HRESULTS are therefore usually talked about in hex, as the bit structure is a lot easier to read in hex\!  Consider 0x80070013, for example.  The high bit is set, so this is an error.  The facility code is 7 and the error code is 0x0013 = 19 in decimal.

 

 

Unfortunately, JScript interprets the 32 bit error code as a **signed** integer and displays it in **decimal**.  No problem -- just convert that thing back to hex, right?

 

 

var x = -2147024877;

print(x.toString(16))

 

 

Whoops, not quite.  JScript doesn't know that you want this as an unsigned number, so it converts it to a signed hex number, -0x7ff8ffed.  We need to convert this thing to the value it would have been had JScript interpreted it as an unsigned number in the first place.  A handy fact to know is that the difference between an unsigned number interpreted as a signed number and the same number interpreted as an unsigned number is always 0x100000000 if the high bit is set, 0 otherwise.

 

 

var x = -2147024877;

print((x\<0?x+0x100000000:x).toString(16))

 

 

There we go.  That prints out 80070013.  Or, even better, we could just write a program that takes the error apart:

 

 

function DumpHR(hr)

{

      if (hr \< 0 )

            hr += 0x100000000;

      if (hr & 0x80000000)

            print("Error code");

      else

            print("Success code");

      var facility = (hr & 0x7FFF0000) \>\> 16;

      print("Facility " + facility);

      var scode = hr & 0x0000FFFF;

      print("SCode " + scode);

}

DumpHR(-2147024877);

 

 

The facility codes are as follows

 

 

FACILITY\_NULL                    0

FACILITY\_RPC                     1

FACILITY\_DISPATCH                2

FACILITY\_STORAGE                 3

FACILITY\_ITF                     4

FACILITY\_WIN32                   7

FACILITY\_WINDOWS                 8

FACILITY\_SECURITY                9

FACILITY\_CONTROL                 10

FACILITY\_CERT                    11

FACILITY\_INTERNET                12

FACILITY\_MEDIASERVER             13

FACILITY\_MSMQ                    14

FACILITY\_SETUPAPI                15

FACILITY\_SCARD                   16

FACILITY\_COMPLUS                 17

FACILITY\_AAF                     18

FACILITY\_URT                     19

FACILITY\_ACS                     20

FACILITY\_DPLAY                   21

FACILITY\_UMI                     22

FACILITY\_SXS                     23

FACILITY\_WINDOWS\_CE              24

FACILITY\_HTTP                    25

FACILITY\_BACKGROUNDCOPY          32

FACILITY\_CONFIGURATION           33

FACILITY\_STATE\_MANAGEMENT        34

FACILITY\_METADIRECTORY           35

 

 

So you can see that our example is a Windows operating system error (facility 7), and looking up error 19 we see that this is ERROR\_WRITE\_PROTECT -- someone is trying to write to a write-protected floppy probably.

 

 

All the errors generated by the script engines -- syntax errors, for example -- are FACILITY\_CONTROL, and the error numbers vary between script engines.  VB also uses FACILITY\_CONTROL, but fortunately VBScript assigns the same meanings to the errors as VB does.  But in general, if you get a FACILITY\_CONTROL error you need to know what control generated the error -- VBScript, JScript, a third party control, what?  Because each control can define their own errors, and there may be collisions.

 

 

Finally, here are some commonly encountered HRESULTs:

 

 

E\_UNEXPECTED  0x8000FFFF "Catestrophic failure" -- something completely unexpected has happened.

E\_NOTIMPL     0x80004001 "Not implemented" -- the developer never got around to writing the method you just called\!

E\_OUTOFMEMORY 0x8007000E -- pretty obvious what happened here

E\_INVALIDARG  0x80070057 -- you passed a bad argument to a method

E\_NOINTERFACE 0x80004002 -- COM is asking an object for an interface.  This can happen if you try to script an object that doesn't support IDispatch.

E\_ABORT       0x80004004 -- whatever you were doing was terminated 

E\_FAIL        0x80004005 -- something failed and we don't know what.

 

 

And finally, here are three that you should see only rarely from script, but script hosts may see them moving around in memory and wonder what is going on:

 

 

SCRIPT\_E\_RECORDED   0x86664004 -- this is how we internally track whether the details of an error have been recorded in the error object or not.  We need a way to say "yes, there was an error, but do not attempt to record information about it again."

SCRIPT\_E\_PROPAGATE  0x80020102 -- another internal code that we use to track the case where a recorded error is being propagated up the call stack to a waiting catch handler.

SCRIPT\_E\_REPORTED   0x80020101 -- the script engines return this to the host when there has been an unhandled error that the host has already been informed about via OnScriptError.

 

 

That's a pretty bare-bones look at error codes, but it should at least get you started next time you have a confusing error number.

